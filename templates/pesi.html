{% extends "layout/base.html" %}

{% block title %}Scheda Pesi{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="mb-0">Scheda Pesi</h2>
        {% if current_user.is_admin or current_user.is_allenatore %}
        <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addEsercizioModal">+ Aggiungi Esercizio</button>
        {% endif %}
    </div>

    {% if current_user.is_admin or current_user.is_allenatore %}
    <div class="card card-body shadow-sm mb-4">
        <form method="GET" class="row g-2 align-items-end">
            <div class="col-md-4">
                <label for="categoria" class="form-label">Categoria</label>
                <select name="categoria" id="categoria" class="form-select" onchange="this.form.submit()">
                    <option value="">Tutte le categorie</option>
                    {% for cat in categorie %}
                    <option value="{{ cat }}" {% if selected_category == cat %}selected{% endif %}>{{ cat }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-4">
                <label for="atleta_id" class="form-label">Seleziona Atleta</label>
                <select name="atleta_id" id="atleta_id" class="form-select" onchange="this.form.submit()">
                    <option value="">Seleziona un atleta...</option>
                    {% for atleta in atleti %}
                    <option value="{{ atleta.id }}" {% if selected_atleta and selected_atleta.id == atleta.id %}selected{% endif %}>
                        {{ atleta.first_name }} {{ atleta.last_name }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-2">
                <a href="/risorse/pesi" class="btn btn-outline-secondary w-100">Resetta</a>
            </div>
        </form>
    </div>
    {% endif %}

    {% if selected_atleta %}
    <form action="/risorse/pesi/update" method="post">
        <input type="hidden" name="atleta_id" value="{{ selected_atleta.id }}">
        <div class="table-responsive">
            <table class="table table-bordered table-hover">
                <thead class="table-light">
                    <tr>
                        <th>Esercizio</th>
                        <th>MAX (kg)</th>
                        <th>5 Rep (kg)</th>
                        <th>7 Rep (kg)</th>
                        <th>10 Rep (kg)</th>
                        <th>20 Rep (kg)</th>
                    </tr>
                </thead>
                <tbody>
                    {% for esercizio in esercizi %}
                    <tr>
                        <td class="fw-bold">{{ esercizio.ordine }} - {{ esercizio.nome }}</td>
                        {% set scheda = scheda_data.get(esercizio.id) %}
                        <td><input type="number" step="0.5" class="form-control" name="massimale_{{ esercizio.id }}" value="{{ scheda.massimale if scheda else '' }}"></td>
                        <td><input type="number" step="0.5" class="form-control" name="5rep_{{ esercizio.id }}" value="{{ scheda.carico_5_rep if scheda else '' }}"></td>
                        <td><input type="number" step="0.5" class="form-control" name="7rep_{{ esercizio.id }}" value="{{ scheda.carico_7_rep if scheda else '' }}"></td>
                        <td><input type="number" step="0.5" class="form-control" name="10rep_{{ esercizio.id }}" value="{{ scheda.carico_10_rep if scheda else '' }}"></td>
                        <td><input type="number" step="0.5" class="form-control" name="20rep_{{ esercizio.id }}" value="{{ scheda.carico_20_rep if scheda else '' }}"></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="text-end mt-3">
            <button type="submit" class="btn btn-primary">Salva Modifiche</button>
        </div>
    </form>
    {% elif current_user.is_admin or current_user.is_allenatore %}
    <div class="alert alert-info">Seleziona un atleta per visualizzare o modificare la sua scheda.</div>
    {% else %}
    <div class="alert alert-warning">Non sei un atleta, non puoi avere una scheda pesi.</div>
    {% endif %}
</div>

<!-- Modale Aggiungi Esercizio -->
<div class="modal fade" id="addEsercizioModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Aggiungi Nuovo Esercizio</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form action="/risorse/pesi/add_esercizio" method="post">
          <div class="modal-body">
            <div class="mb-3">
                <label for="ordine" class="form-label">Numero Ordine</label>
                <input type="number" class="form-control" name="ordine" id="ordine" required>
            </div>
            <div class="mb-3">
                <label for="nome" class="form-label">Nome Esercizio</label>
                <input type="text" class="form-control" name="nome" id="nome" required>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annulla</button>
            <button type="submit" class="btn btn-primary">Aggiungi</button>
          </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}
