{% extends "layout/base.html" %}
{% block title %}Atleti{% endblock %}
{% block content %}
<h1>Atleti</h1>

<form method="get" class="row g-2 mb-3">
  <div class="col-auto">
    <input type="text" class="form-control" name="q" placeholder="Ricerca" value="{{ q or '' }}">
  </div>
  <div class="col-auto">
    <button class="btn btn-primary" type="submit">Cerca</button>
  </div>
  <div class="col-auto">
    <select name="categoria" class="form-select" onchange="this.form.submit()">
      <option value="">Tutte le categorie</option>
      {% for c in categories %}
      <option value="{{ c.nome }}" {% if c.nome == categoria %}selected{% endif %}>{{ c.nome }}</option>
      {% endfor %}
    </select>
  </div>
</form>

<table class="table table-hover align-middle">
  <thead class="table-light">
    <tr>
      <th>Nome e Cognome</th>
      <th>Categoria</th>
      <th>Scadenza Cert. Medico</th>
    </tr>
  </thead>
  <tbody>
  {% for row in rows %}
    <tr onclick="window.location='/risorse/athletes/{{ row.user.id }}';" style="cursor:pointer;">
      <td class="fw-bold">{{ row.user.last_name }} {{ row.user.first_name }}</td>
      <td>{{ row.category or '' }}</td>
      <td class="text-center">
        {% if row.user.certificate_expiration %}
          {% set days_left = (row.user.certificate_expiration - today).days %}
          {% set badge_class = 'text-dark' %}
          {% if days_left <= 0 %}
            {% set badge_class = 'bg-dark text-white' %}
          {% elif days_left <= 30 %}
            {% set badge_class = 'bg-danger text-white' %}
          {% elif days_left <= 90 %}
            {% set badge_class = 'bg-warning text-dark' %}
          {% else %}
            {% set badge_class = 'bg-success text-white' %}
          {% endif %}
          <span class="badge rounded-pill {{ badge_class }}">{{ row.user.certificate_expiration.strftime('%d/%m/%Y') }}</span>
        {% else %}
          <span class="badge rounded-pill bg-secondary">N/D</span>
        {% endif %}
      </td>
    </tr>
  {% endfor %}
  </tbody>
</table>
{% endblock %}
