<!-- templates/dashboard.html -->
{% extends "layout/base.html" %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="container-fluid px-4 py-5">
    <h1 class="display-5 fw-bold">Ciao, {{ current_user.first_name or current_user.username }}!</h1>
    <p class="col-lg-8 fs-4">Usa i collegamenti qua sotto per accedere alle varie sezioni della Webapp. Di seguito i tuoi prossimi eventi:</p>

    <div class="mb-4">
        {% if events %}
            {% for ev in events %}
                {% if ev.type == 'allenamento' %}
                <div class="dashboard-event p-2 mb-2 rounded text-white d-flex justify-content-between align-items-center"
                     style="background-color: {{ ev.color }};"
                     data-type="allenamento"
                     data-id="{{ ev.id }}"
                     data-title="{{ ev.title }}"
                     data-date="{{ ev.date.strftime('%A %d/%m') }}"
                     data-time="{{ ev.start.strftime('%H:%M') }}{% if ev.end %} - {{ ev.end.strftime('%H:%M') }}{% endif %}"
                     data-start="{{ ev.start.isoformat() }}"
                     data-description="{{ ev.description }}"
                     data-categories="{{ ev.categories }}"
                     data-catlist='{{ ev.category_names|tojson|safe }}'
                     data-coaches="{{ ev.coaches }}"
                     data-recurrence="{{ ev.recurrence }}"
                     data-status="{{ ev.status }}">
                    <span class="fw-semibold">{{ ev.title }}</span>
                    <span>{{ ev.date.strftime('%A %d/%m') }}</span>
                </div>
                {% else %}
                <div class="dashboard-event p-3 mb-2 border border-info border-2 rounded d-flex justify-content-between align-items-center"
                     data-link="/turni"
                     style="cursor: pointer;"
                     data-type="turno"
                     data-id="{{ ev.id }}"
                     data-title="Turno {{ ev.fascia }}"
                     data-date="{{ ev.date.strftime('%A %d/%m') }}"
                     data-time="{{ ev.start.strftime('%H:%M') }}{% if ev.end %} - {{ ev.end.strftime('%H:%M') }}{% endif %}"
                     data-start="{{ ev.start.isoformat() }}"
                     data-description="Turno {{ ev.fascia }}"
                     data-categories="-"
                     data-coaches="-"
                     data-recurrence="No">
                    <span class="fw-semibold">{{ ev.title }}</span>
                    <span>{{ ev.date.strftime('%A %d/%m') }}</span>
                </div>
                {% endif %}
            {% endfor %}
        {% else %}
        <p class="text-muted">Nessun evento in programma.</p>
        {% endif %}
    </div>

    <!-- Modale Dettaglio Evento -->
    {% include 'partials/event_modal.html' %}

    <hr class="my-4">

    <div class="row g-4">
        <!-- Card Allenamenti -->
        <div class="col-md-6 col-lg-4">
            <div class="card h-100 shadow-sm">
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title">🗓️ Allenamenti</h5>
                    <p class="card-text">Visualizza il calendario, la lista e gestisci gli allenamenti.</p>
                    <div class="mt-auto pt-3">
                        <a href="/calendario" class="btn btn-primary">Vai agli Allenamenti</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Card Attività -->
        <div class="col-md-6 col-lg-4">
            <div class="card h-100 shadow-sm">
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title">🎯 Attività</h5>
                    <p class="card-text">Gestisci le attività della società, calendario eventi, pagamenti e assegnazioni istruttori.</p>
                    <div class="mt-auto pt-3">
                        <a href="/attivita/calendario" class="btn btn-success me-2">Calendario</a>
                        <a href="/attivita/gestione" class="btn btn-success">Gestione</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Card Gestione Turni (Solo per Admin) -->
        {% if current_user.is_admin %}
        <div class="col-md-6 col-lg-4">
            <div class="card h-100 shadow-sm border border-info border-2" style="cursor: pointer;" onclick="window.location.href='/turni';">
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title">🕒 Turni</h5>
                    <p class="card-text">Assegna gli allenatori ai turni di apertura e chiusura della società.</p>
                    <div class="mt-auto pt-3">
                        <a href="/turni" class="btn btn-primary">Gestisci Turni</a>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Card Risorse -->
        <div class="col-md-6 col-lg-4">
            <div class="card h-100 shadow-sm">
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title">🚣 Risorse</h5>
                    <p class="card-text">Gestisci le imbarcazioni, i mezzi di trasporto e le schede pesi degli atleti.</p>
                    <div class="mt-auto pt-3">
                        <a href="/risorse/barche" class="btn btn-primary me-2">Barche</a>
                        {% if current_user.is_allenatore or current_user.is_admin %}
                        <a href="/mezzi" class="btn btn-primary me-2">Mezzi</a>
                        {% endif %}
                        <a href="/atleti" class="btn btn-primary me-2">Atleti</a>
                        <a href="/risorse/pesi" class="btn btn-primary">Pesi</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Card Gestione Utenti (Solo per Admin) -->
        {% if current_user.is_admin %}
        <div class="col-md-6 col-lg-4">
            <div class="card h-100 shadow-sm border-warning">
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title">👥 Utenti</h5>
                    <p class="card-text">Aggiungi, modifica o rimuovi utenti dal sistema.</p>
                    <div class="mt-auto pt-3">
                        <a href="/admin/users" class="btn btn-warning">Gestisci Utenti</a>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', path='js/attendance_self.js') }}"></script>
{% if current_user.is_allenatore or current_user.is_admin %}
<script src="{{ url_for('static', path='js/attendance_admin.js') }}"></script>
{% endif %}
<script src="{{ url_for('static', path='js/event_modal.js') }}"></script>
{% endblock %}
