<!-- templates/dashboard.html -->
{% extends "layout/base.html" %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="container-fluid px-4 py-5">
    <h1 class="display-5 fw-bold">Ciao, {{ current_user.first_name or current_user.username }}!</h1>
    <p class="col-lg-8 fs-4">Usa i collegamenti qua sotto per accedere alle varie sezioni della Webapp. Di seguito i tuoi prossimi eventi:</p>

    <div class="mb-4">
        {% if events %}
            {% for ev in events %}
                {% if ev.type == 'allenamento' %}
                <div class="dashboard-event p-2 mb-2 rounded text-white d-flex justify-content-between align-items-center"
                     style="background-color: {{ ev.color }};"
                     data-title="{{ ev.title }}"
                     data-date="{{ ev.date.strftime('%A, %d %B %Y') }}"
                     data-time="{{ ev.start.strftime('%H:%M') }}{% if ev.end %} - {{ ev.end.strftime('%H:%M') }}{% endif %}"
                     data-description="{{ ev.description }}"
                     data-categories="{{ ev.categories }}"
                     data-coaches="{{ ev.coaches }}"
                     data-recurrence="{{ ev.recurrence }}">
                    <span class="fw-semibold">{{ ev.title }}</span>
                    <span>{{ ev.date.strftime('%d/%m/%Y') }} - {{ ev.start.strftime('%H:%M') }}{% if ev.end %} - {{ ev.end.strftime('%H:%M') }}{% endif %}</span>
                </div>
                {% else %}
                <div class="dashboard-event p-3 mb-2 border border-info border-2 rounded d-flex justify-content-between align-items-center"
                     data-link="/turni"
                     style="cursor: pointer;"
                     data-title="Turno {{ ev.fascia }}"
                     data-date="{{ ev.date.strftime('%A, %d %B %Y') }}"
                     data-time="{{ ev.start.strftime('%H:%M') }}{% if ev.end %} - {{ ev.end.strftime('%H:%M') }}{% endif %}"
                     data-description="Turno {{ ev.fascia }}"
                     data-categories="-"
                     data-coaches="-"
                     data-recurrence="No">
                    <span class="fw-bold">{{ ev.date.strftime('%d/%m/%Y') }} - {{ ev.fascia }}</span>
                    <span>üïí {{ ev.start.strftime('%H:%M') }}{% if ev.end %} - {{ ev.end.strftime('%H:%M') }}{% endif %}</span>
                </div>
                {% endif %}
            {% endfor %}
        {% else %}
        <p class="text-muted">Nessun evento in programma.</p>
        {% endif %}
    </div>

    <hr class="my-4">

    <div class="row g-4">
        <!-- Card Allenamenti -->
        <div class="col-md-6 col-lg-4">
            <div class="card h-100 shadow-sm">
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title">üóìÔ∏è Allenamenti</h5>
                    <p class="card-text">Visualizza il calendario, la lista e gestisci gli allenamenti.</p>
                    <div class="mt-auto pt-3">
                        <a href="/calendario" class="btn btn-primary">Vai agli Allenamenti</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Card Rubrica -->
        <div class="col-md-6 col-lg-4">
            <div class="card h-100 shadow-sm">
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title">üìñ Rubrica</h5>
                    <p class="card-text">Consulta l'elenco di tutti i soci della canottieri.</p>
                    <div class="mt-auto pt-3">
                        <a href="/rubrica" class="btn btn-primary">Apri la Rubrica</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Card Gestione Turni (Solo per Admin) -->
        {% if current_user.is_admin %}
        <div class="col-md-6 col-lg-4">
            <div class="card h-100 shadow-sm border border-info border-2" style="cursor: pointer;" onclick="window.location.href='/turni';">
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title">üïí Turni</h5>
                    <p class="card-text">Assegna gli allenatori ai turni di apertura e chiusura della societ√†.</p>
                    <div class="mt-auto pt-3">
                        <a href="/turni" class="btn btn-primary">Gestisci Turni</a>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Card Risorse -->
        <div class="col-md-6 col-lg-4">
            <div class="card h-100 shadow-sm">
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title">üö£ Risorse</h5>
                    <p class="card-text">Gestisci le imbarcazioni e le schede pesi degli atleti.</p>
                    <div class="mt-auto pt-3">
                        <a href="/risorse/barche" class="btn btn-primary me-2">Barche</a>
                        <a href="/risorse/pesi" class="btn btn-primary">Pesi</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Card Gestione Utenti (Solo per Admin) -->
        {% if current_user.is_admin %}
        <div class="col-md-6 col-lg-4">
            <div class="card h-100 shadow-sm border-warning">
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title">üë• Utenti</h5>
                    <p class="card-text">Aggiungi, modifica o rimuovi utenti dal sistema.</p>
                    <div class="mt-auto pt-3">
                        <a href="/admin/users" class="btn btn-warning">Gestisci Utenti</a>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function () {
    const modalEl = document.getElementById('eventDetailModal');
    if (!modalEl) return;
    const modal = new bootstrap.Modal(modalEl);
    const modalTitle = document.getElementById('modalTitle');
    const modalDate = document.getElementById('modalDate');
    const modalTime = document.getElementById('modalTime');
    const modalDescription = document.getElementById('modalDescription');
    const modalCategories = document.getElementById('modalCategories');
    const modalCoaches = document.getElementById('modalCoaches');
    const modalRecurrence = document.getElementById('modalRecurrence');
    const editBtn = document.getElementById('modalEditButton');
    const deleteBtn = document.getElementById('modalDeleteButton');

    document.querySelectorAll('.dashboard-event').forEach(el => {
        el.addEventListener('click', () => {
            if (el.dataset.link) {
                window.location.href = el.dataset.link;
                return;
            }
            const data = el.dataset;
            modalTitle.textContent = data.title;
            modalDate.textContent = data.date;
            modalTime.textContent = data.time;
            modalDescription.textContent = data.description || '-';
            modalCategories.textContent = data.categories || '-';
            modalCoaches.textContent = data.coaches || '-';
            modalRecurrence.textContent = data.recurrence || '-';
            if (editBtn) editBtn.classList.add('d-none');
            if (deleteBtn) deleteBtn.classList.add('d-none');
            modal.show();
        });
    });
});
</script>
{% endblock %}

