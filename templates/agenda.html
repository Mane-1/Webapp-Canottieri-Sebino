{% extends "layout/base.html" %}
{% block title %}Agenda{% endblock %}
{% block head_extra %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.css">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js"></script>
{% endblock %}
{% block content %}
<div class="container p-3">
  <h1 class="h2 mb-4">Agenda</h1>
  <div class="d-flex justify-content-end mb-3">
    <a id="icsLinkBtn" class="btn btn-sm btn-outline-secondary" href="#">Link calendario</a>
  </div>
  <div id="agenda-calendar" data-src="/api/allenamenti"></div>
</div>
{% endblock %}
{% block scripts %}
<script src="{{ url_for('static', path='js/calendar_responsive.js') }}"></script>
<script>
  document.addEventListener('DOMContentLoaded', async () => {
    const el = document.getElementById('agenda-calendar');
    window.initResponsiveCalendar(el, {
      eventSource: el.dataset.src,
      initialDesktop: 'timeGridWeek',
      initialMobile: 'listWeek',
      rightDesktop: 'dayGridMonth,timeGridWeek,listWeek',
      rightMobile: 'listDay,listWeek',
      locale: 'it'
    });

    try {
      const r = await fetch('/api/calendar/link');
      const { ics_url } = await r.json();
      const btn = document.getElementById('icsLinkBtn');
      btn.href = location.origin + ics_url;
      btn.target = '_blank';
    } catch (e) {}
  });
</script>
{% endblock %}
