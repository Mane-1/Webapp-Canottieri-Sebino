{% extends "layout/base.html" %}
{% block title %}Dettaglio Allenamento{% endblock %}
{% block content %}
<h1>Dettaglio Allenamento</h1>
<ul class="nav nav-tabs" role="tablist">
  <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#details" role="tab">Dettagli</a></li>
  <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#attendance" role="tab">Presenze</a></li>
</ul>
<div class="tab-content mt-3">
  <div class="tab-pane fade show active" id="details" role="tabpanel">
    <form method="post" action="{{ url_for('update_training', training_id=training.id) }}">
      <div class="mb-3">
        <label class="form-label">Tipo</label>
        <input type="text" class="form-control" name="tipo" value="{{ training.tipo }}" />
      </div>
      <div class="mb-3">
        <label class="form-label">Data</label>
        <input type="date" class="form-control" name="data" value="{{ training.data }}" />
      </div>
      <button class="btn btn-primary" type="submit">Salva</button>
    </form>
  </div>
  <div class="tab-pane fade" id="attendance" role="tabpanel">
    <table class="table">
      <thead><tr><th>Nome</th><th>Stato</th><th>Azioni</th></tr></thead>
      <tbody>
      {% for row in roster %}
        <tr data-athlete-id="{{ row.athlete_id }}">
          <td>{{ row.name }}</td>
          <td class="status">{{ row.status }}</td>
          <td>
            <button type="button" class="btn btn-sm btn-secondary" onclick="quickToggle({{ training.id }}, {{ row.athlete_id }})">Toggle</button>
          </td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
{% block scripts %}
{{ super() }}
<script src="{{ url_for('static', path='js/attendance_admin.js') }}"></script>
<script>
function quickToggle(trainingId, athleteId) {
  const row = document.querySelector(`tr[data-athlete-id='${athleteId}']`);
  const current = row.querySelector('.status').innerText === 'present' ? 'absent' : 'present';
  setAttendance(trainingId, athleteId, current).then(data => {
    row.querySelector('.status').innerText = data.status;
  });
}
</script>
{% endblock %}
